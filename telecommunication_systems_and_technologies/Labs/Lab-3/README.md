# Лабораторная работа №3. *Мониторинг сетевого трафика на хосте на примере работы с утилитами диагностики и мониторинга сетевых соединений в Linux*

[Файл с полным ТЗ+Теория](Net_LabDescription_3.pdf)

## Цель работы
Получить практические навыки работы с анализаторами сетевого трафика, ознакомиться с принципами работы активного сетевого оборудования, изучить особенности взаимодействия сетевого и канального уровней стека TCP/IP, форматы кадров Ethernet и консольные утилиты диагностики и мониторинга сетевых соединений в Linux.

## Необходимое программное обеспечение и условия
- Компьютер с установленной средой виртуализации VirtualBox
- Две виртуальные машины Linux
- Административные учетные записи на виртуальных машинах
- Сетевое подключение по протоколу IP
- Доступ в сеть Интернет
- Программный пакет Wireshark

---

## Краткие теоретические сведения
Linux является UNIX-подобной многозадачной операционной системой, в которой основным интерфейсом является текстовая консоль. Для получения справочной информации по командам используются утилиты `man`, `apropos`, `whatis`, а также ключи `-h` и `--help`.

Для диагностики сетевых соединений применяется протокол ICMP и утилиты `ping`, `traceroute`, `mtr`.  
Для мониторинга сетевых интерфейсов и трафика используются утилиты `nload`, `iftop`, `bmon`, `vnstat`, `nethogs`.  
Для анализа сетевых соединений применяются `netstat`, `ss`, `lsof`.  
Для перехвата и анализа сетевого трафика используются анализаторы трафика (снифферы), такие как `tcpdump` и Wireshark.

---

## Часть 1. Настройка инфраструктуры

1. Подготовить две виртуальные машины Linux с именами `c7-1` и `c7-2`.
2. Настроить сетевые интерфейсы обеих машин в режим **NAT** с включенным неразборчивым режимом; получение IP-адресов — автоматически по DHCP.
3. Определить полученные IP-адреса для `c7-1` и `c7-2`.
4. Установить Wireshark на реальный хост.
5. С хоста `c7-1` проверить доступность внешней сети с помощью `ping`.
6. Проверить наличие и при необходимости установить утилиты:
    - bmon (или аналоги nload, iftop)
    - nethogs
    - mtr
    - traceroute
    - vnstat
    - nc

---

## Часть 2. Диагностика соединения

1. Ознакомиться с ключами утилиты `ping`.
2. На хосте `c7-2` выполнить команду `ping`, отправляющую 5 пакетов размером 1500 байт с интервалом 10 секунд на хост `c7-1`.
3. Определить назначение ключа `-f` утилиты `ping`.
4. Ознакомиться с возможностями утилиты `mtr`.
5. С хоста `c7-1` собрать статистику соединения с узлом `www.itmo.ru`.
6. Сохранить в файл расширенную статистику `mtr` при отправке 40 пакетов.

---

## Часть 3. Работа с Wireshark

1. Настроить перехват трафика на реальном сетевом интерфейсе с ограничением объема до 5 МБ.
2. С использованием инструментов статистики определить:
    - узел с максимальной сетевой активностью;
    - узел с наибольшим числом широковещательных рассылок;
    - самый активный TCP-порт;
    - графики интенсивности TCP и UDP трафика (IO Graphs);
    - диаграмму связей HTTPS-трафика (Flow Graph).
3. Написать фильтры Wireshark для:
    - DNS-трафика клиента (UDP/TCP порт 53);
    - всех кадров Ethernet, отправленных с интерфейса хоста;
    - широковещательных сообщений и определить назначение не менее трех таких рассылок.
4. По результатам анализа определить тип используемого коммутационного оборудования.

---

## Часть 4. Определение маршрута прохождения пакета

1. Ознакомиться с ключами утилиты `traceroute`.
2. На хосте `c7-1` выполнить команды traceroute:
    - с использованием ICMP;
    - с использованием UDP;
    - с использованием TCP;
    - для определения наличия фрагментации IPv4.

---

## Часть 5. Текущий мониторинг сетевых интерфейсов

1. С хоста `c7-2` запустить `ping` в режиме flood на хост `c7-1`.
2. На хосте `c7-1` с помощью `bmon` (или аналога) определить загрузку сетевого интерфейса.
3. Изменять размер пакета от 100 до 60100 байт с шагом 10000 и определить влияние на загрузку интерфейса.

---

## Часть 6. Сбор статистики загрузки интерфейса

1. На хосте `c7-1` запустить демон `vnstat`.
2. Настроить мониторинг интерфейса, соединяющего `c7-1` и `c7-2`.
3. С хоста `c7-2` отправить 500 пакетов в режиме flood.
4. Вывести статистику собранного трафика.

---

## Часть 7. Диагностика работы приложений через сеть

1. Установить несколько SSH-соединений с хоста `c7-2` на `c7-1`.
2. На `c7-1` вывести список прослушиваемых портов с помощью `netstat` или `lsof`.
3. Вывести список установленных соединений.
4. Написать скрипт, выводящий список IP-адресов и количество соединений с них к заданному порту (по умолчанию 22).
5. Закрыть все SSH-соединения.
6. Ознакомиться с ключами утилиты `nethogs`.
7. Подключиться по SSH и запустить `top`.
8. С помощью `nethogs` определить среднюю скорость передачи данных и PID процесса `sshd`.

---

## Часть 8. Работа с утилитой nc (NetCat)

1. На хосте `c7-1` запустить `tcpdump` для перехвата трафика портов 9999 и 4444 с выводом содержимого сообщений.
2. Передать текстовый файл (не менее 20 слов) между машинами через TCP-порт 9999.
3. Организовать текстовый чат между машинами через UDP-порт 4444 и завершить сессию.
4. Остановить `tcpdump` и проанализировать перехваченный трафик.

---

## Требования к отчету
Отчет должен быть выполнен в формате DOC/DOCX или PDF и содержать:
- титульный лист;
- артефакты выполнения заданий;
- ответы на контрольные вопросы.
