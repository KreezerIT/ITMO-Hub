# Лабораторная работа №7. *DNS*

[Файл с полным ТЗ+Теория](Net_LabDescription_7.pdf)

## Цель работы
Закрепить понимание принципов работы системы DNS, получить практические навыки использования утилит для работы с DNS-серверами и конфигурирования DNS-сервера на платформе Linux.

## Требования
- Среда виртуализации Oracle VirtualBox
- Виртуальная машина Linux CentOS 7  
  (допускается использование другой ОС Linux, но описание приводится для CentOS 7)

---

## Краткие теоретические сведения
DNS (Domain Name System) — распределённая клиент-серверная система, предназначенная для сопоставления доменных имён и IP-адресов. DNS-клиент получает IP-адрес DNS-сервера в качестве параметра конфигурации и обращается к нему напрямую.

DNS-сервер может хранить данные о зонах доменов или выполнять рекурсивные запросы. В DNS используются различные типы ресурсных записей, включая:
- **SOA** — начальная запись зоны;
- **A** — IPv4-адрес;
- **AAAA** — IPv6-адрес;
- **CNAME** — псевдоним;
- **MX** — почтовые серверы;
- **NS** — DNS-серверы зоны;
- **PTR** — записи обратного просмотра;
- **SRV** — записи служб;
- **TXT** — текстовые записи (SPF, DKIM и др.).

На платформе Linux наиболее распространённым DNS-сервером является **BIND**. Конфигурационные файлы сервера располагаются в каталогах `/etc` и `/etc/named`. Для клиентских DNS-запросов используется утилита `dig`, входящая в пакет `bind-utils`.

---

## Часть 1. Подготовка и проверка конфигурации

1. Создать связанный клон виртуальной машины:
    - c7-1
    - c7-2
2. Для виртуальной машины c7-1 добавить второй сетевой интерфейс.
3. Подключить сетевой интерфейс c7-2 и дополнительный интерфейс c7-1 к внутренней сети `intnet`.
4. Основной интерфейс c7-1 подключить к NAT.
5. Назначить IP-адреса:
    - c7-1: 10.0.0.1/24
    - c7-2: 10.0.0.2/24
6. Для внешнего интерфейса c7-1 оставить получение адреса по DHCP.
7. Отключить IPv6 на обеих виртуальных машинах.
8. Задать имена хостов в соответствии с именами виртуальных машин.
9. Проверить связность хостов по внутренней сети и доступ в Интернет с c7-1.
10. Убедиться, что на c7-2 в качестве шлюза по умолчанию и DNS-сервера указан адрес c7-1.
11. Установить на c7-1 пакеты `bind` и `bind-utils`.

---

## Часть 2. Получение информации из DNS с помощью dig

1. На хосте c7-1 выполнить команду `dig www.itmo.ru` и изучить содержимое секций:
    - HEADER
    - QUESTION SECTION
    - ANSWER SECTION
    - AUTHORITY SECTION
    - SERVER
    - WHEN
    - MSG SIZE
2. С помощью утилиты `dig`:
    - вывести только IP-адрес для имени `www.itmo.ru`;
    - получить расширенный вывод с отображением промежуточных DNS-серверов и определить, какой сервер вернул ответ;
    - получить SOA-запись домена `itmo.ru` и определить назначение всех числовых параметров;
    - определить MX-записи домена `itmo.ru`;
    - определить NS-записи домена `itmo.ru` и IP-адреса DNS-серверов;
    - получить PTR-запись для IP-адреса 87.250.250.242;
    - определить количество серверов, обслуживающих корневую зону DNS.

---

## Часть 3. Настройка кэширующего DNS-сервера

1. Разрешить службе DNS доступ к сети с помощью `firewall-cmd`.
2. Включить и запустить службу `named` с помощью `systemctl`.
3. Отредактировать файл `/etc/named.conf` так, чтобы сервер:
    - отвечал по IPv4-адресу локальной сети;
    - не использовал IPv6;
    - принимал обычные и рекурсивные запросы только с локальной сети и с самого хоста;
    - выполнял рекурсивные запросы;
    - вместо версии сервера возвращал строку «My Own DNS Server».
4. Проверить корректность разрешения имён на хосте c7-2.

---

## Часть 4. Создание собственной доменной зоны

1. Добавить в `/etc/named.conf` зону домена `<fio>.local`, где `<fio>` — инициалы студента, указав:
    - сервер как основной для зоны;
    - запрет трансфера зоны;
    - разрешение всех обновлений;
    - файл зоны `/var/named/<fio>.local.db`.
2. Проверить конфигурацию с помощью `named-checkconf`.
3. Создать файл зоны `<fio>.local.db`, содержащий:
    - SOA-запись;
    - основной DNS-сервер `ns1`;
    - e-mail администратора `hostmaster@<fio>.local`;
    - серийный номер зоны в формате `YYYYMMDDhh`;
    - записи A для `ns1` и `gate`;
    - псевдоним `www`, указывающий на `gate.<fio>.local`.
4. Проверить файл зоны с помощью `named-checkzone`.
5. На хосте c7-2 проверить работоспособность всех записей доменной зоны.

---

## Требования к отчету
Отчет должен быть выполнен в формате DOC/DOCX или PDF и содержать:
- команды и консольный вывод из части 2;
- конфигурационный файл `/etc/named.conf`;
- параметры, добавленные при создании зоны;
- файл зоны `<fio>.local.db`.
