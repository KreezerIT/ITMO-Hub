# Лабораторная работа №4. *Работа с файлово-каталожной системой в ОС Linux*

[Файл с полным ТЗ+Теория](OS_LabDescription_4.pdf)

## Задание на лабораторную работу

Создайте скрипты для перечисленных заданий и предъявите их преподавателю.  
**ВНИМАНИЕ!** Все скрипты должны обрабатывать любые сценарии, соответствующие заданию, в том числе некорректный ввод параметров пользователем, использование имен файлов с необычными, но разрешёнными символами, различные последовательности запусков скриптов и другие действия в файловой системе.  
Все возникающие ошибки должны корректно обрабатываться, и сообщения выводиться пользователю средствами скрипта.

---

### 1. Скрипт `rmtrash`

1. Скрипту передается один параметр – имя файла в текущем каталоге вызова скрипта.

2. Скрипт проверяет, создан ли скрытый каталог `trash` в домашнем каталоге пользователя.  
   Если он не создан – создаёт его.

3. После этого скрипт создаёт в этом каталоге **жесткую ссылку** на переданный файл с уникальным именем  
   (например, присваивает каждой новой ссылке имя, соответствующее следующему натуральному числу)  
   и удаляет файл в текущем каталоге.

4. Затем в скрытый файл `trash.log` в домашнем каталоге пользователя помещается запись, содержащая  
   полный исходный путь к удалённому файлу и имя созданной жесткой ссылки.

---

### 2. Скрипт `untrash`

1. Скрипту передается один параметр – имя файла, который нужно восстановить (без полного пути — только имя).

2. Скрипт по файлу `trash.log` должен найти все записи, содержащие в качестве имени файла переданный параметр,  
   и выводить по одному на экран полные имена таких файлов **с запросом подтверждения**.

3. Если пользователь отвечает положительно, предпринимается попытка восстановить файл по указанному пути  
   (создать в соответствующем каталоге жесткую ссылку на файл из `trash` и удалить файл из `trash`).  
   Если каталога, указанного в пути, не существует, файл восстанавливается в домашний каталог пользователя  
   с выводом соответствующего сообщения.  
   Если невозможно создать жесткую ссылку (конфликт имён и т.п.), пользователю предлагается изменить имя  
   восстанавливаемого файла.

---

### 3. Скрипт `backup`

1. Скрипт создаст в `/home/user/` каталог с именем `Backup-YYYY-MM-DD`  
   (дата запуска скрипта), если в `/home/user/` **нет каталога**, созданного менее 7 дней назад.  
   Если "действующий" каталог резервного копирования уже есть — новый не создаётся.  
   Для определения текущей даты можно использовать команду `date`.

2. Если новый каталог был создан, скрипт копирует в него **все файлы** из каталога `/home/user/source/`.  
   После этого скрипт дописывает в файл `/home/user/backup-report` строку о создании каталога и список  
   скопированных файлов.

3. Если каталог резервного копирования **не был создан**, то:

    - файлы копируются в существующий каталог по правилам:
        - если файла там нет — копируется;
        - если файл есть — сравниваются размеры:
            - если размеры совпадают — ничего не копируется;
            - если различаются — создаётся **версионная копия**:  
              существующий файл переименовывается в `имя.YYYY-MM-DD`, а новый копируется под своим именем.

    - по окончании копирования в файл `/home/user/backup-report` дописывается:
        - строка о внесении изменений,
        - имена добавленных файлов с новыми именами,
        - имена добавленных файлов, у которых была создана версия, с указанием нового имени старой версии.

---

### 4. Скрипт `upback`

1. Скрипт должен скопировать в каталог `/home/user/restore/` все файлы
   из **актуального на данный момент каталога резервного копирования** (имеющего в имени наиболее свежую дату),
   **за исключением файлов с предыдущими версиями**.
